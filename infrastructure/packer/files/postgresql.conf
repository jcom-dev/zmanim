# PostgreSQL 17 Configuration for Zmanim
# Optimized for m7g.medium (2 vCPU, 4GB RAM)

# CONNECTIONS AND AUTHENTICATION
listen_addresses = 'localhost'
port = 5432
max_connections = 100
unix_socket_directories = '/var/run/postgresql'

# RESOURCE USAGE (4GB RAM available)
shared_buffers = 1GB              # 25% of system RAM
effective_cache_size = 3GB        # 75% of system RAM
work_mem = 10MB                   # Per-query work memory
maintenance_work_mem = 256MB      # For VACUUM, CREATE INDEX

# WRITE AHEAD LOG
wal_buffers = 16MB
min_wal_size = 1GB
max_wal_size = 4GB
checkpoint_completion_target = 0.9

# QUERY TUNING
random_page_cost = 1.1            # SSD (EBS gp3)
effective_io_concurrency = 200    # SSD parallel I/O

# LOGGING
log_destination = 'stderr'
logging_collector = on
log_directory = '/var/log/postgresql'
log_filename = 'postgresql-%a.log'
log_truncate_on_rotation = on
log_rotation_age = 1d
log_rotation_size = 0
log_line_prefix = '%m [%p] %u@%d '
log_timezone = 'UTC'

# LOCALE AND FORMATTING
datestyle = 'iso, mdy'
timezone = 'UTC'
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'
default_text_search_config = 'pg_catalog.english'

# EXTENSIONS
# Note: pg_cron removed - not installed by default
# shared_preload_libraries = ''

# DATA DIRECTORY
data_directory = '/data/postgres'
